import:
  - source: Alfresco/alfresco-build-tools:.travis.docker_login.yml@v1.1.5
  - source: Alfresco/alfresco-build-tools:.travis.docker_hub_login.yml@v1.1.5
  - source: Alfresco/alfresco-build-tools:.travis.java.yml@v1.1.5
  - source: Alfresco/alfresco-build-tools:.travis.pre-commit.yml@v1.1.5

dist: focal

jdk:
  - openjdk17
  - openjdk11

git:
  depth: false
  quiet: true

branches:
  only:
    - none

stages:
  - name: test
    if: commit_message !~ /\[skip tests\]/
  - name: release
    if: commit_message ~= /\[release\]/ AND branch = master AND type != push AND type != pull_request AND fork = false

env:
  global:
    - MAVEN_INSTALL_CMD="mvn clean install -B"

jobs:
  include:
    - name: "current version Java 17"
      stage: test
      jdk: openjdk17
      script:
        - ${MAVEN_INSTALL_CMD}

    - name: "current version Java 11"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD}

    - name: "7.3 Enterprise Java 17"
      stage: test
      jdk: openjdk17
      script:
        - ${MAVEN_INSTALL_CMD} -Penterprise-73-tests

    - name: "7.3 Community Java 17"
      stage: test
      jdk: openjdk17
      script:
        - ${MAVEN_INSTALL_CMD} -Pcommunity-73-tests

    - name: "7.3 Enterprise Java 11"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Penterprise-73-tests

    - name: "7.3 Community Java 11"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Pcommunity-73-tests

    - name: "7.2 Enterprise"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Penterprise-72-tests

    - name: "7.2 Community"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Pcommunity-72-tests

    - name: "7.1 Enterprise"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Penterprise-71-tests

    - name: "7.1 Community"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Pcommunity-71-tests

    - name: "7.0 Enterprise"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Penterprise-70-tests

    - name: "7.0 Community"
      stage: test
      jdk: openjdk11
      script:
        - ${MAVEN_INSTALL_CMD} -Pcommunity-70-tests
